
    <app-barname-info [item]="selectedOption" (cancelRegister)="cancelRegisterMode($event)"></app-barname-info>

  
  
  
  
    <div class="container">

     
      <!-- an hidden div is created to set the position of appearance of the menu-->
      <div style="visibility: hidden; position: fixed;"
      [style.left.px]="menuTopLeftPosition.x"
      [style.top.px]="menuTopLeftPosition.y"
      [matMenuTriggerFor]="rightMenu"></div>
      
      <!-- standar material menu -->
      <mat-menu #rightMenu="matMenu" >
       
        <div
        style="direction: rtl;"
       >
        <ng-template matMenuContent let-item="item" >
          <div
          (click) = "$event.stopPropagation()">

         
            <div class="p-3 mb-2 bg-primary text-white" style="margin-bottom: 10px; font: 1em BTraffic;">فعالیت های&nbsp; {{item.content+1}}&nbsp;{{monthName[month-1]}}</div>
   

            <button mat-menu-item style="background-color: transparent; border: transparent;" >
              <mat-checkbox 
                    [aria-label]="" 
                    value="{{selectedActivity_1_ForDay[item.content+1].value}}"
                    [(ngModel)]="selectedActivity_1_ForDay[item.content+1].checked">
              </mat-checkbox>&nbsp;&nbsp; &nbsp;&nbsp; <span style=" font-family: BTraffic;">فعالیت 1</span> 
            </button>
       
            <button mat-menu-item >
              <mat-checkbox 
                    
                    [aria-label]="" 
                    value="{{selectedActivity_2_ForDay[item.content+1].value}}"
                    [(ngModel)]="selectedActivity_2_ForDay[item.content+1].checked">
              </mat-checkbox>&nbsp;&nbsp; &nbsp;&nbsp; <span style=" font-family: BTraffic;">فعالیت 2</span> 
            </button>
       
    
       
            <button mat-menu-item style="background-color: transparent; border: transparent;" >
              <mat-checkbox 
                    [aria-label]="" 
                    value="{{selectedActivity_3_ForDay[item.content+1].value}}"
                    [(ngModel)]="selectedActivity_3_ForDay[item.content+1].checked">
              </mat-checkbox>&nbsp;&nbsp; &nbsp;&nbsp; <span style=" font-family: BTraffic;">فعالیت 3</span> 
            </button>
       
      <ejs-multiselect id='multiselectelement' [dataSource]='data2' [placeholder]='placeholder' ></ejs-multiselect>

            </div>
            <div class="box">
             <div>
                 <button class="btn btn-info">
                   <mat-icon color = "primary"
                  class="delete_btn_all" >
                  check_circle_outline
                   </mat-icon></button>
                 <button class="btn btn-danger" (click)="uncheckedActivityFnc(item.content+1)">
                  <mat-icon>cancel</mat-icon>
                 </button>     
              </div>
         
            </div>

        </ng-template>
       
      </div>
  
      </mat-menu>
      </div>

   


    <div class="container"  
(mousedown)="mouseClickDown($event)"
(mouseup)="mouseClickUp($event)">
    <form [formGroup]="resourceForm" >

      <div class="row">
        <div class="col">
          <div class="form-group">
          
            <ejs-dropdownlist 
            [(ngModel)]="selectedOption"
            enableRtl='true' 
            floatLabelType="Auto" 
            id='ddlelement' 
            #samples 
            [dataSource]='dataResource' 
            [fields]='fieldResource' 
            formControlName="resourceId" 
            [placeholder]='textResource' [allowFiltering]='true' 
            (filtering)='onFilteringResource($event)'
            (change)="onChangeResource($event['value'])">a
          </ejs-dropdownlist>
        
          </div>
        </div>

        <div class="col">
          <div class="form-group">
          
            <ejs-dropdownlist 
            [(ngModel)]="selectedCapacity"
            enableRtl='true' 
            floatLabelType="Auto" 
            id='requestResId' 
            #samples 
            [dataSource]='data' 
            [fields]='capacityFields' 
            formControlName="capacity"
            [placeholder]='textCapacity' 
            (change)="onChangeRequestRes($event['value'])"
            >
            </ejs-dropdownlist>
        
          </div>
        </div>

        <div class="col" style="width: 50px;">
          <div class="form-group" >
            
            <div class="" >
              <span class="" style="color: rgb(160, 159, 159);"></span>
                  <div style="height: 30px;;border-bottom:  1px solid rgb(160, 159, 159);  margin-top: 20px; text-align: right ;" >
                     
                
                  {{resourceUnit}}
                  
                  </div>
            
              
              
          
          </div>
    
    
          </div>
        </div>
    
     
        <div class="col">
          <div class="form-group">
          
            <ejs-dropdownlist 
            enableRtl='true' 
            floatLabelType="Auto" 
            id='yearId' 
            #samples 
            [dataSource]='yearData' 
            [fields]='yearFields' 
           
            formControlName="yearFormControl"
            [placeholder]='textYear' 
            (change)="onChangeYear($event.value)"
            >
            </ejs-dropdownlist>
        
          </div>
        </div>
     
     
        <div class="col">
          <div class="form-group">
          
            <ejs-dropdownlist 
            enableRtl='true' 
            floatLabelType="Auto" 
            id='monthId' 
            #samples 
            [dataSource]='monthData' 
            [fields]='fieldMonth' 
            formControlName="monthFormControl"
            [placeholder]='textMonth' 
            (change)="onChangeMonth($event.value)"
            >
            </ejs-dropdownlist>
        
          </div>
        </div>
     
     
      </div>

    </form>

    <div>
      <button
      
      class="btn-success regbtn btnok"
      (click)="register()">ثبت </button>
     
    
    </div>
 <div class="flex-container ">
  <div
  style="">
          <table style="text-align: center;">
          <!-- <thead>
            <tr>
              <th>قبلاٌ انتخاب کرده‌اید</th>
              <th>نداشتن ظرفیت</th>
              <th>انتخاب</th>
              <th>صف تقاضا</th>
        
            </tr>
          </thead> -->
          <tbody>
            <!-- <tr>
              <td class="accepted legend_tr"  ></td>
              <td class="prim_reg legend_tr"  ></td>
              <td class="unavailable_Cell_ForReg legend_tr"></td>
              <td class="selected_Cell_ForReg legend_tr"></td>
              <td class="in_query_legend legend_tr"></td>
          
            </tr> -->
            <tr>
              
              <th class="accepted legend_tr col-2" >تخصیص داده شده</th>
              <th class="prim_reg legend_tr col-2" >قبلاٌ انتخاب کرده‌اید</th>
              <th class="unavailable_Cell_ForReg  col-2 legend_tr">نداشتن ظرفیت</th>
              <th class="selected_Cell_ForReg   col-2 legend_tr">انتخاب</th>
              <th class="in_query_legend legend_tr  col-2 ">صف تقاضا</th>
        
            </tr>
            <!-- <tr>
              <td class="accepted legend_tr"></td>
              <td class="prim_reg legend_tr"></td>
              <td class="unavailable_Cell_ForReg legend_tr"></td>
              <td class="selected_Cell_ForReg legend_tr"></td>
              <td class="in_query_legend legend_tr"></td>
          
            </tr> -->
          </tbody>
        </table> 
  </div>

 
  <div  class="flex-container1" [@openClose]="isShown ? 'open' : 'closed'">
<div class="div1 fl"></div>
      <div class="div2 fl">
          <ejs-multiselect enableRtl='true' #checkboxForDaySelection floatLabelType="Auto" id='dayId' #samples [dataSource]='dataDay' [fields]='fieldsDay' formControlName="day" [placeholder]='textDay' [allowFiltering]='true' >a</ejs-multiselect>
    
      </div>
      <div class="div3 fl" style="vertical-align: middle;">
            <button
            style="   margin-top: 45%; "
            class="btn btn-primary"
            (click)="daySelectFunc()">انتخاب روز</button>
    </div>


</div>
</div>


  <div class="flex-container2">
  <div class="div1"
  style="background-color: transparent;">
   
  </div>
  <div class="div2" 
  style="display: flex;
  justify-content: center;
  background-color: transparent;">
 ساعت
  </div>

  <div  class="div3" >
    <button class=" more_btn " 
    style="margin-bottom: 20px;"
    (click)="divFunction()">
      <mat-icon color = "" >more_horiz</mat-icon>
    </button>
  </div>
 

  
</div>



<div id="table-wrapper">
  <div id="table-scroll" class="fixTableHead">
        <table  class='table  table-sm tableShadow table_allocation'  aria-labelledby="tableLabel" style=" border:1px solid;  user-select: none; text-align: center; ">  

                
      <thead style="background-color: #d7bde2;">  
        <tr>  
          <th scope="col" *ngFor="let column of header">  
      
            {{column === 'activity' ? 'فعالیت' : (column === 'hour' ? 'روز' :column) }}  
          </th>
          
          
        
            
          <th   
          [@openClose]="isShown ? 'open' : 'closed'"
          class="advPartHead"  > 
            <mat-checkbox [aria-label]="" 
                name="checkedAll"
                value=""
                (click)="selectAll()"
                [(ngModel)]="selectAllDays"
                class="delete_btn_all">
              
            </mat-checkbox>
  
            
          </th> 

          <th   
          [@openClose]="isShown ? 'open' : 'closed'"
          class="advPartHead">
        <button 
          style="background-color: transparent; border: transparent;"
          (click)="deleteAll(resourceId, year, month,  barnameId)">
            <mat-icon color = "warn" class="delete_btn delete_btn_all">
              delete
            </mat-icon>
          
          </button>
          </th> 
          <th   
          [@openClose]="isShown ? 'open' : 'closed'"
          class="advPartHead delete_btn_all" >
          <button 
          style="background-color: transparent; border: transparent;"
          >
          <mat-icon color = "primary"
          class="delete_btn_all" >
          file_copy
            </mat-icon>
          
          </button>
          </th>
        
          <th   
          [@openClose]="isShown ? 'open' : 'closed'"
          class="advPartHead" >
            <button 
            style="background-color: transparent; border: transparent;"
            (click)="pasteAll()">
            <mat-icon color = "primary"
            class="delete_btn_all" >
              format_paint
              </mat-icon>
            
            </button>
          </th>

          <th>{{header[0]=== 'hour' ? 'روز' :header[0]}}</th>


        
        
        
          </tr>  
      </thead>  
      <tbody>  
      
        <tr class="prTableRow" 
        *ngFor="let row of RowsData| slice:1;let indexOfElement=index;"
        (contextmenu)="onRightClick($event, {content: indexOfElement })">  
            <td  
          
            (mouseover)="onCellClick( indexOfElement, column )" 
            (mousedown)="onCellClickSingleClick( indexOfElement, column,$event )" 
            ondragstart="return false;" ondrop="return false;"
            *ngFor="let column of header"
    
            
                      
            [ngClass]="
            (column != 'hour' && IsCellClickForEachBarname[indexOfElement]['accepted'][column])? 'accepted'
            :(column != 'hour' && IsCellClickForEachBarname[indexOfElement]['waiting'][column])? 'prim_reg'
            :(column != 'hour' && IsCellClick[indexOfElement][column])? 'selected_Cell_ForReg'
            :(column != 'activity' && column != 'hour' && RowsData[indexOfElement+1][column] < requestVolume )? 'unavailable_Cell_ForReg'
            :(column != 'hour' && RowsDataForColor[indexOfElement+1][column] >= requestVolume )? 'available_Cell_ForReg'
            : (column == 'hour')? 'table_head': 'in_query_'+math.round(math.max(math.min((requestVolume-RowsDataForColor[indexOfElement+1][column])/10,10),0))" 
    
    
            > 
          
          {{row[column]}}
          </td> 
        
          <td   [@openClose]="isShown ? 'open' : 'closed'"  >
            <mat-checkbox [aria-label]="" 
          
              value="{{selectedDaysForDeletion[indexOfElement].value}}"
              [(ngModel)]="selectedDaysForDeletion[indexOfElement].checked">
            </mat-checkbox>
          </td>

          <td   [@openClose]="isShown ? 'open' : 'closed'">            
            <button 
              style="background-color: transparent; border: transparent;"
              (click)="deleteRequestConform(resourceId, year, month, indexOfElement+1, barnameId)">
              <mat-icon color = "warn" class="delete_btn">
                delete
              </mat-icon>
            </button>
          </td>
          

          <td   [@openClose]="isShown ? 'open' : 'closed'"  >
            <button 
              style="background-color: transparent; border: transparent;"
              (click)="copyRowPattern( indexOfElement+1)">
    
                  <mat-icon color = "primary" class="delete_btn">
                    file_copy
                  </mat-icon>
              
            </button>
          </td>

          <td   [@openClose]="isShown ? 'open' : 'closed'" >
            <mat-checkbox [aria-label]="" 
                value="{{selectedDaysForPaste[indexOfElement].value}}"
                [(ngModel)]="selectedDaysForPaste[indexOfElement].checked">
            </mat-checkbox>
          </td>

          <td [ngClass]="'table_head'">
            {{RowsData[indexOfElement+1]['hour']}}
          </td>

        </tr>  
      </tbody>  
</table> 
  </div>
  </div>



    
  
</div>

